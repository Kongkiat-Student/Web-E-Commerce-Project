var product = [{
    id: 1,
    img: 'https://healthytohome.net/wp-content/uploads/2023/03/Mood-%E0%B8%AD%E0%B8%B2%E0%B8%AB%E0%B8%B2%E0%B8%A3%E0%B9%80%E0%B8%AA%E0%B8%A3%E0%B8%B4%E0%B8%A1%E0%B8%9C%E0%B8%B9%E0%B9%89%E0%B8%AB%E0%B8%8D%E0%B8%B4%E0%B8%87-%E0%B8%AD%E0%B8%B2%E0%B8%AB%E0%B8%B2%E0%B8%A3%E0%B9%80%E0%B8%AA%E0%B8%A3%E0%B8%B4%E0%B8%A1%E0%B8%A7%E0%B8%B1%E0%B8%A2%E0%B8%97%E0%B8%AD%E0%B8%87-2.webp',
    name: 'Mood',
    price: 699,
    description:'Mood อาหารเสริมผู้หญิง ปรับฮอร์โมน อกกระชับ ผิวเปร่งหลั่ง ลดตกขาว ตัวช่วยจบทุกเรื่องของผู้หญิง',
    type: 'food supplement',
},{
    id: 2,
    img: 'https://www.premacare.co.th/assets/file/product/homepage/202301/271220-ft-fmp67profile.png',
    name: 'ซิมล็อกซ์',
    price: 499,
    description:'ซิมล็อกซ์ รวมสูตรอาหารเสริม น้ำหนัก สำหรับผู้กังวลเรื่องน้ำหนักตัว อ้วน บริษัทพรีมา แคร์ โรงงานรับผลิตครีม เวชสำอาง เครื่องสำอาง อาหารเสริม',
    type: 'food supplement',
},{
    id: 3,
    img: 'https://smooth-e.com/wp-content/uploads/2023/06/IMMU-Dietary-Supplement-Product-By-Smooth-Life-%E0%B8%AD%E0%B8%B4%E0%B8%A1%E0%B8%A1%E0%B8%B9%E0%B8%9E%E0%B8%A5%E0%B8%B1%E0%B8%AA-%E0%B8%9C%E0%B8%A5%E0%B8%B4%E0%B8%95%E0%B8%A0%E0%B8%B1%E0%B8%93%E0%B8%91%E0%B9%8C%E0%B9%80%E0%B8%AA%E0%B8%A3%E0%B8%B4%E0%B8%A1%E0%B8%AD%E0%B8%B2%E0%B8%AB%E0%B8%B2%E0%B8%A3-%E0%B9%80%E0%B8%AA%E0%B8%A3%E0%B8%B4%E0%B8%A1%E0%B8%AA%E0%B8%A3%E0%B9%89%E0%B8%B2%E0%B8%87%E0%B8%A0%E0%B8%B9%E0%B8%A1%E0%B8%B4%E0%B8%84%E0%B8%B8%E0%B9%89%E0%B8%A1%E0%B8%81%E0%B8%B1%E0%B8%99-2.webp',
    name: 'IMMU',
    price: 799,
    description:'IMMU กระตุ้นระบบภูมิคุ้มกันของร่างกาย (Immune System)กระตุ้นเซลล์เม็ดเลือดขาวที่มีหน้าที่กำจัดสิ่งแปลกปลอม เชื้อแบคที่เรีย เชื้อไวรัสช่วยบำรุงสุขภาพกระดูกและฟันให้แข็งแรง มีส่วนช่วยในการดูดซึมแคลเซียมและฟอสฟอรัสคุณสมบัติ และสารสกัด 6 ชนิดช่วยต่อต้านอนุมูลอิสระ เสริมสร้างภูมิคุ้มกัน กระตุ้นการสร้างคอลลาเจนใต้ชั้นผิว ด้วยสารสกัด อเซโรร่า เชอร์รี่ดิบ (Green Acerola Cherry Extract)ช่วยลดและป้องกันการเกิดไข้หวัด ต้านการติดเชื้อไวรัส และแบคทีเรีย ด้วยเอลเดอร์เบอร์รี (ELDERBERRY)กระตุ้นเม็ดเลือดขาว เสริมสร้าง ระบบภูมิคุ้มกัน ด้วยวิตามินดี 3 (vitamin D3)ฟื้นฟูและซ่อมแซมเซลล์ ด้วยผลไม้แห่งความเยาว์วัยจาก สารสกัดจากพลกหลาบ (Rose Hip)ป้องกันหวัดและภูมิแพ้ เสริมสร้างคลอลาเจน ด้วยวิตามินซี (Vitamin C)ฟื้นฟูการทำงานของระบบภูมิต้านทาน ด้วย ซิงค์ อะมิโนแอซิดคีเลต (zinc amino acid chelate)',
    type: 'food supplement',
  },{
    id: 4,
    img: 'https://f.btwcdn.com/store-47048/product/24ee1be5-b00f-a734-e76a-65fcf788abe6.jpg',
    name: 'มัลติ-วี',
    price: 1190,
    description:'มัลติ-วี ช่วยล้างลำไส้จากสารสกัดจากผักเข้มข้นหลากชนิด บำรุงสุขภาพลำไส้ ช่วยกระตุ้นการไหลเวียนโลหิต ให้การหมุนเวียนโลหิตในร่างกายเป็นไปอย่างสะดวก ช่วยให้เซลล์ได้รับสารอาหารและออกซิเจน อย่างเพียงพอ ยังช่วยลดไขมันในเลือด ลดไขมันเลว เพิ่มไขมันดี ลดคอเลสเตอรอล ช่วยลดความเสี่ยง การเกิดโรคหลอดเลือดและหัวใจ',
    type: 'food supplement',
  },{
    id: 5,
    img: 'https://down-th.img.susercontent.com/file/9085f8900460586bc6dc88c29cdc4623',
    name: 'บาลานส์ โปร มิกซ์',
    price: 199,
    description:'บาลานส์ โปร มิกซ์ อาหารเสริมสุขภาพคุณภาพสูงJ เสริมสร้างระบบภูมิคุ้มกัน บำรุงระบบการทำงานของไต',
    type: 'food supplement',
}];
//[{},{},{}] // length = 3

// var product;

$(document).ready(() => {

  // $.ajax({
  //   method: 'get',
  //   url: './api/getallproduct.php',
  //   success: function(response){
  //     console.log(response)
  //     if(response.RespCode == 200){
  //       product = response.Result;
  //       var html = "";
  //       for (let i = 0; i < product.length; i++) {
  //         html += `<div onclick="openProductDetail(${i})" class="product-items ${product[i].type}">
  //                   <img class="product-img" src="./Image/${product[i].img}" alt="">
  //                   <p style="font-size: 1.2vw;">${product[i].name}</p>
  //                   <p stlye="font-size: 1vw;">${numberWithCommas(product[i].price)}THB</p>
  //               </div>`;
  //         }
  //         $("#productlist").html(html);
  //     }
  //   },error: function(err){
  //     console.log(err)
  //   }   
  // })

  var html = "";
  for (let i = 0; i < product.length; i++) {
    html += `<div onclick="openProductDetail(${i})" class="product-items ${
      product[i].type}">
                    <img class="product-img" src="${product[i].img}" alt="">
                    <p style="font-size: 1.2vw;">${product[i].name}</p>
                    <p stlye="font-size: 1vw;">${numberWithCommas(product[i].price)}THB</p>
                </div>`;
  }
  $("#productlist").html(html);

});

function numberWithCommas(x) {
  x = x.toString();
  var pattern = /(-?\d+)(\d{3})/;
  while (pattern.test(x)) 
    x = x.replace(pattern, "$1,$2");
  return x;
}

function searchsomething(elem) {
  // console.log('#'+elem.id)
  var value = $("#" + elem.id).val();
  console.log(value);
  // <img class="product-img" src="./Image/${product[i].img}" alt=""></img>
  var html = "";
  for (let i = 0; i < product.length; i++) {
    if (product[i].name.includes(value)) {
      html += `<div onclick="openProductDetail(${i})" class="product-items ${product[i].type}">
              <img class="product-img" src="${product[i].img}" alt=""> 
              <p style="font-size: 1.2vw;">${product[i].name}</p>
              <p stlye="font-size: 1vw;">${numberWithCommas(product[i].price)} THB</p>
          </div>`;
      }
  }
  if (html == "") {
    $("#productlist").html(`<p>Not found product</p>`);
  } else {
    $("#productlist").html(html);
  }
}


function searchproduct(param) {
  console.log(param);
  $(".product-items").css("display", "none");
  if (param == "all") {
    $(".product-items").css("display", "block");
  } else {
    $("." + param).css("display", "block");
  }
}

var productindex = 0;
function openProductDetail(index) {
  productindex = index;
  console.log(productindex);
  $("#modalDesc").css("display", "flex");
  $("#mdd-img").attr("src", product[index].img);
  // $("#mdd-img").attr("src",'./Image/'+ product[index].img);
  $("#mdd-name").text(product[index].name);
  $("#mdd-price").text(numberWithCommas(product[index].price) + " THB");
  $("#mdd-desc").text(product[index].description);
}

function closeModal() {
  $(".modal").css("display", "none");
}

var cart = [];
function addtocart() {
  var pass = true;

  for (let i = 0; i < cart.length; i++) {
    if (productindex == cart[i].index) {
      console.log("found same product");
      cart[i].count++;
      pass = false;
    }
  }

  if (pass) {
    var obj = {
      index: productindex,
      id: product[productindex].id,
      name: product[productindex].name,
      price: product[productindex].price,
      img: product[productindex].img,
      count: 1,
    };
    // console.log(obj)
    cart.push(obj);
  }
  console.log(cart);

  Swal.fire({
    icon: "success",
    title: "Add " + product[productindex].name + " to cart !",
  });
  $("#cartcount").css("display", "flex").text(cart.length);
}

function openCart() {
  $("#modalCart").css("display", "flex");
  rendercart();
}

// {/* <img src="./Image/${cart[i].img}" alt=""></img> */}
function rendercart() {
  if (cart.length > 0) {
    var html = "";
    for (let i = 0; i < cart.length; i++) {
      html += `<div class="cartlist-items">
                        <div class="cartlist-left">
                            <img src="${cart[i].img}" alt="">
                            <div class="cartlist-detail">
                                <p style="font-size: 1.5vw;">${cart[i].name}</p>
                                <p style="font-size: 1.2vw;">${numberWithCommas(
                                  cart[i].price * cart[i].count
                                )} THB</p>
                            </div>
                        </div>
                        <div class="cartlist-right">
                            <p onclick="deinitems('-', ${i})" class="btnc">-</p>
                            <p id="countitems${i}" style="margin: 0 20px;">${
        cart[i].count
      }</p>
                            <p onclick="deinitems('+', ${i})" class="btnc">+</p>
                        </div>
                    </div>`;
    }
    $("#mycart").html(html);
  } else {
    $("#mycart").html(`<p>Not found product list</p>`);
  }
}

function deinitems(action, index) {
  if (action == "-") {
    if (cart[index].count > 0) {
      cart[index].count--;
      $("#countitems" + index).text(cart[index].count);

      if (cart[index].count <= 0) {
        Swal.fire({
          icon: "warning",
          title: "Are you sure to delete?",
          showConfirmButton: true,
          showCancelButton: true,
          confirmButtonText: "Delete",
          cancelButtonText: "Cancel",
        }).then((res) => {
          if (res.isConfirmed) {
            cart.splice(index, 1);
            console.log(cart);
            rendercart();
            $("#cartcount").css("display", "flex").text(cart.length);

            if (cart.length <= 0) {
              $("#cartcount").css("display", "none");
            }
          } else {
            cart[index].count++;
            $("#countitems" + index).text(cart[index].count);
            rendercart();
          }
        });
      }
      rendercart();
    }
  } else if (action == "+") {
    cart[index].count++;
    $("#countitems" + index).text(cart[index].count);
    rendercart();
  }
}

// function buynow() {

// }
